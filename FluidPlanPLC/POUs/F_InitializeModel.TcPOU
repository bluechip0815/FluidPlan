(*====================================================================
    FUNCTION F_InitializeModel
    Description: Manually populates the global model configuration arrays.
                 Matches the topology defined in model.json.
====================================================================*)
FUNCTION F_InitializeModel : BOOL
VAR
    // No local variables needed for static initialization
END_VAR

// 1. Clear arrays to ensure a clean state
MEMSET(ADR(GVL.g_arElementConfigs), 0, SIZEOF(GVL.g_arElementConfigs));
MEMSET(ADR(GVL.g_arConnections), 0, SIZEOF(GVL.g_arConnections));

// --------------------------------------------------------
// DEFINE ELEMENTS 
// --------------------------------------------------------

// Element 1: Supply (Pressure Source)
GVL.g_arElementConfigs[1].eType := E_ElementType.Supply;
GVL.g_arElementConfigs[1].sName := 'Supply';
GVL.g_arElementConfigs[1].fInitialPressure := 6.0; // 6 Bar
GVL.g_arElementConfigs[1].fVolume := 0.0; // Infinite volume (Source)

// Element 2: EPU (Electronic Pressure Unit - Active Element)
GVL.g_arElementConfigs[2].eType := E_ElementType.EPU;
GVL.g_arElementConfigs[2].sName := 'EPU';
GVL.g_arElementConfigs[2].fConnectionArea := 3.14159E-4; // 20mm dia
GVL.g_arElementConfigs[2].stEpuParams.fTimeConstant := 0.1;
GVL.g_arElementConfigs[2].stEpuParams.fMaxDpDt := 35.0;
GVL.g_arElementConfigs[2].stEpuParams.fNaturalFrequency := 20.0;
GVL.g_arElementConfigs[2].stEpuParams.fDampingRatio := 0.7;

// Element 3: R1 (Pipe)
GVL.g_arElementConfigs[3].eType := E_ElementType.Pipe;
GVL.g_arElementConfigs[3].sName := 'R1';
GVL.g_arElementConfigs[3].fVolume := 3.14159E-5; // 10cm * 2cm
GVL.g_arElementConfigs[3].fConnectionArea := 3.14159E-4;

// Element 4: R2 (Pipe)
GVL.g_arElementConfigs[4].eType := E_ElementType.Pipe;
GVL.g_arElementConfigs[4].sName := 'R2';
GVL.g_arElementConfigs[4].fVolume := 3.14159E-5;
GVL.g_arElementConfigs[4].fConnectionArea := 3.14159E-4;

// Element 5: R3 (Pipe)
GVL.g_arElementConfigs[5].eType := E_ElementType.Pipe;
GVL.g_arElementConfigs[5].sName := 'R3';
GVL.g_arElementConfigs[5].fVolume := 3.14159E-5;
GVL.g_arElementConfigs[5].fConnectionArea := 3.14159E-4;

// Element 6: V1 (Valve)
GVL.g_arElementConfigs[6].eType := E_ElementType.Valve;
GVL.g_arElementConfigs[6].sName := 'V1';
GVL.g_arElementConfigs[6].fConnectionArea := 3.14159E-4;
GVL.g_arElementConfigs[6].fVolume := 1.0E-6; // Minimal volume for calculation stability
GVL.g_arElementConfigs[6].stValveParams.fOpenTime_s := 0.05;

// Element 7: V2 (Valve)
GVL.g_arElementConfigs[7].eType := E_ElementType.Valve;
GVL.g_arElementConfigs[7].sName := 'V2';
GVL.g_arElementConfigs[7].fConnectionArea := 3.14159E-4;
GVL.g_arElementConfigs[7].fVolume := 1.0E-6;
GVL.g_arElementConfigs[7].stValveParams.fOpenTime_s := 0.05;

// Element 8: T1 (Tank)
GVL.g_arElementConfigs[8].eType := E_ElementType.Tank;
GVL.g_arElementConfigs[8].sName := 'T1';
GVL.g_arElementConfigs[8].fVolume := 0.002; // 2 Liters
GVL.g_arElementConfigs[8].fConnectionArea := 3.14159E-4;
GVL.g_arElementConfigs[8].fInitialPressure := 0.0; // Start empty/atmospheric

// --------------------------------------------------------
// DEFINE CONNECTIONS
// --------------------------------------------------------
// Mapping which element is connected to which.
// Indices correspond to the g_arElementConfigs index defined above.

// 1. Supply -> R1
GVL.g_arConnections[1].iElementA := 1; 
GVL.g_arConnections[1].iElementB := 3;

// 2. R1 -> V1
GVL.g_arConnections[2].iElementA := 3; 
GVL.g_arConnections[2].iElementB := 6;

// 3. V1 -> R2
GVL.g_arConnections[3].iElementA := 6; 
GVL.g_arConnections[3].iElementB := 4;

// 4. R1 -> EPU
GVL.g_arConnections[4].iElementA := 3; 
GVL.g_arConnections[4].iElementB := 2;

// 5. EPU -> R3
GVL.g_arConnections[5].iElementA := 2; 
GVL.g_arConnections[5].iElementB := 5;

// 6. R3 -> V2
GVL.g_arConnections[6].iElementA := 5; 
GVL.g_arConnections[6].iElementB := 7;

// 7. V2 -> R2
GVL.g_arConnections[7].iElementA := 7; 
GVL.g_arConnections[7].iElementB := 4;

// 8. R2 -> T1 (Tank)
GVL.g_arConnections[8].iElementA := 4; 
GVL.g_arConnections[8].iElementB := 8;


// Return TRUE to indicate initialization is complete
F_InitializeModel := TRUE;

END_FUNCTION